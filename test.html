<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>London Tube Station Heatmap</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    <style>
        /* Custom CSS for map container to ensure it takes full height */
        #map {
            height: 80vh; /* Set a responsive height for the map */
            width: 100%;
            border-radius: 0.5rem; /* Apply rounded corners */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add a subtle shadow */
        }
        body {
            font-family: 'Inter', sans-serif; /* Use Inter font */
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 lg:p-8">
    <div class="container mx-auto p-4 bg-white rounded-lg shadow-xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-4 rounded-md p-2 bg-blue-100">
            London Tube Station Busyness Heatmap
        </h1>
        <p class="text-center text-gray-600 mb-6">
            This heatmap visualizes the relative busyness of London tube stations based on a sample of live footfall data compared to baseline.
            Higher intensity (redder areas) indicates more crowding.
        </p>

        <!-- Map container -->
        <div id="map" class="mb-6"></div>

        <div class="text-center text-gray-500 text-sm">
            <p>Data Source: Sample data derived from provided CSV files.</p>
            <p>Map tiles by <a href="https://www.openstreetmap.org/copyright" target="_blank" class="text-blue-500 hover:underline">OpenStreetMap</a> contributors.</p>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
    <!-- Leaflet.heat JS for heatmap -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <script>
        // Ensure all scripts and the DOM are loaded before initializing the map
        window.onload = function() {
            // Sample data for London tube stations (lat, lon, crowding_ratio, station_name)
            // This data simulates the processed CSV data and is expanded for better heatmap visualization.
            const stationData = [
                // Central London (high crowding potential, increased density)
                [51.513132, -0.090047, 1.9, 'Bank'],
                [51.514304, -0.149723, 2.2, 'Bond Street'],
                [51.50741, -0.127277, 2.0, 'Charing Cross'],
                [51.513093, -0.124436, 2.1, 'Covent Garden'],
                [51.518247, -0.111583, 1.8, 'Chancery Lane'],
                [51.51151, -0.090432, 1.7, 'Cannon Street'],
                [51.515037, -0.072384, 1.6, 'Aldgate East'],
                [51.496359, -0.143102, 2.5, 'Victoria'], // Very busy
                [51.5187, -0.1171, 2.3, 'Holborn'],
                [51.515, -0.075, 1.9, 'Aldgate'],
                [51.508, -0.128, 2.0, 'Embankment'],
                [51.517, -0.146, 2.4, 'Oxford Circus'], // Very busy
                [51.513, -0.094, 1.8, 'Monument'],
                [51.509, -0.107, 1.9, 'London Bridge'],
                [51.519, -0.134, 2.1, 'Tottenham Court Road'],
                [51.500, -0.125, 2.0, 'Waterloo'],
                [51.517, -0.073, 1.7, 'Liverpool Street'],
                [51.509, -0.076, 1.6, 'Tower Hill'],
                [51.522, -0.155, 1.8, 'Baker Street'],
                [51.523, -0.138, 1.9, 'Euston'],
                [51.531, -0.123, 1.7, 'King\'s Cross St. Pancras'],

                // North London
                [51.565478, -0.134819, 1.2, 'Archway'],
                [51.616446, -0.133062, 1.0, 'Arnos Grove'],
                [51.558655, -0.107457, 1.1, 'Arsenal'],
                [51.539292, -0.14274, 1.4, 'Camden Town'],
                [51.556, -0.102, 1.0, 'Highbury & Islington'],
                [51.579, -0.078, 0.9, 'Finsbury Park'],

                // South London
                [51.443288, -0.152997, 1.3, 'Balham'],
                [51.462618, -0.114888, 1.5, 'Brixton'],
                [51.461742, -0.138317, 1.1, 'Clapham Common'],
                [51.479932, -0.142142, 1.3, 'Battersea Power Station'],
                [51.485743, -0.124204, 1.4, 'Vauxhall'],
                [51.463, -0.093, 1.2, 'Elephant & Castle'],

                // East London
                [51.524839, -0.011538, 0.9, 'Bromley-by-Bow'],
                [51.539321, 0.081053, 1.1, 'Barking'],
                [51.513584, 0.008322, 1.0, 'Canning Town'],
                [51.528136, 0.005055, 1.2, 'West Ham'],
                [51.505, 0.000, 1.3, 'Canary Wharf'],

                // West London
                [51.503057, -0.280462, 1.2, 'Acton Town'],
                [51.495635, -0.324939, 0.8, 'Boston Manor'],
                [51.490311, -0.213427, 1.3, 'Barons Court'],
                [51.512284, -0.187938, 1.1, 'Bayswater'],
                [51.511959, -0.224297, 1.0, 'White City'],
                [51.546565, -0.477949, 0.7, 'Uxbridge'], // Far out
                [51.540627, -0.29961, 0.9, 'Alperton'],

                // Example of very low crowding (outskirts)
                [51.674126, -0.607714, 0.3, 'Amersham'],
                [51.705208, -0.611247, 0.2, 'Chesham'],
                [51.657446, -0.417377, 0.4, 'Watford'],
                [51.559063, 0.250882, 0.5, 'Upminster']
            ];

            // Initialize the map
            const map = L.map('map').setView([51.505, -0.09], 11); // Centered on London, zoom level 11

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Prepare data for heatmap: Leaflet.heat requires data in [lat, lon, intensity] format
            // The 'intensity' here is our 'crowding_ratio'
            const heatData = stationData.map(station => [
                station[0], // latitude
                station[1], // longitude
                station[2]  // crowding_ratio as intensity
            ]);

            // Add heatmap layer
            // Adjust radius, blur, and gradient for better visualization
            L.heatLayer(heatData, {
                radius: 25, // Radius of the individual heat points
                blur: 15,   // Amount of blur to apply
                maxZoom: 13, // Max zoom level to show heatmap
                gradient: {
                    0.0: 'blue',    // Very low crowding
                    0.2: 'cyan',
                    0.4: 'lime',
                    0.6: 'yellow',
                    0.8: 'orange',
                    1.0: 'red'      // Very high crowding
                }
            }).addTo(map);

            // Optional: Add markers for individual stations with popups
            // This provides context for the heatmap points.
            stationData.forEach(station => {
                L.marker([station[0], station[1]])
                    .bindPopup(`<b>Station:</b> ${station[3]}<br><b>Crowding:</b> ${station[2].toFixed(2)}`)
                    .addTo(map);
            });

            // Adjust map view on window resize
            window.addEventListener('resize', () => {
                map.invalidateSize();
            });
        }; // End of window.onload
    </script>
</body>
</html>
